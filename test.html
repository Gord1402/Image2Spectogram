<!DOCTYPE html>
<html>
<head>
    <title>Chirp Detector Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .panel { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .log { background: #f5f5f5; padding: 10px; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 12px; }
        .log .error { color: red; }
        .log .warn { color: orange; }
        .log .info { color: blue; }
        button { margin: 5px; padding: 8px 15px; }
        .detection { background: yellow; padding: 5px; margin: 2px; }
    </style>
</head>
<body>
    <h1>Chirp Detector Debug</h1>
    
    <div class="panel">
        <h3>1. Initialization</h3>
        <button onclick="app.initialize().then(() => log('Initialized'))">Initialize</button>
        <button onclick="app.start()">Start Microphone</button>
        <button onclick="app.startTestMode()">Start Test Mode</button>
        <button onclick="app.stop()">Stop</button>
    </div>

    <div class="panel">
        <h3>2. Add Templates</h3>
        <button onclick="addTemplate('up_chirp', 1.0, 100, 2000)">Up Chirp (100→2000Hz, 1s)</button>
        <button onclick="addTemplate('fast_chirp', 0.5, 500, 3000)">Fast Chirp (500→3000Hz, 0.5s)</button>
        <button onclick="addTemplate('down_chirp', 1.0, 2000, 100)">Down Chirp (2000→100Hz, 1s)</button>
    </div>

    <div class="panel">
        <h3>3. Test Signals</h3>
        <button onclick="app.playTestChirp(1.0, 100, 2000)">Play Up Chirp</button>
        <button onclick="app.playTestChirp(0.5, 500, 3000)">Play Fast Chirp</button>
        <button onclick="app.playTestChirp(1.0, 2000, 100)">Play Down Chirp</button>
    </div>

    <div class="panel">
        <h3>4. Settings</h3>
        Threshold: <input type="range" id="threshold" min="0.01" max="0.5" step="0.01" value="0.1" onchange="app.setDetectionThreshold(this.value)">
        <span id="thresholdValue">0.1</span>
    </div>

    <div class="panel">
        <h3>Detections</h3>
        <div id="detections"></div>
    </div>

    <div class="panel">
        <h3>Debug Log</h3>
        <div id="log" class="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script src="chirp-detector.js"></script>
    <script>
        const app = new AudioWorkletChirpDetector();
        app.debugMode = true;
        
        // Setup logging to UI
        app.onLog = (message, level) => {
            const logDiv = document.getElementById('log');
            const logEntry = document.createElement('div');
            logEntry.className = level;
            logEntry.textContent = message;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        // Setup detection display
        app.onDetection((detection) => {
            const detectionsDiv = document.getElementById('detections');
            const detectionEl = document.createElement('div');
            detectionEl.className = 'detection';
            detectionEl.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong><br>
                ${detection.name} - Confidence: ${detection.confidence.toFixed(4)}<br>
                <small>Timestamp: ${detection.timestamp.toFixed(2)}s</small>
            `;
            detectionsDiv.appendChild(detectionEl);
        });

        // Helper functions
        function addTemplate(name, duration, f0, f1) {
            app.addTemplate(name, duration, f0, f1);
            log(`Added template: ${name}`);
        }

        function log(message) {
            app.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Update threshold display
        document.getElementById('threshold').addEventListener('input', function() {
            document.getElementById('thresholdValue').textContent = this.value;
        });

        // Initialize on load
        app.initialize().then(success => {
            if (success) {
                log('Auto-initialized successfully');
            }
        });
    </script>
</body>
</html>